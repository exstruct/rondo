[
  {
    "doc": [
      1,
      2,
      3,
      4
    ],
    "expected": [
      1,
      3
    ],
    "name": "test repeated removes",
    "patch": {
      "1": [
        1,
        2
      ],
      "2": [],
      "3": []
    }
  },
  {
    "doc": [
      1,
      2,
      3,
      4
    ],
    "expected": [
      2,
      3,
      4
    ],
    "name": "test remove on array",
    "patch": {
      "0": [
        1,
        1
      ],
      "1": [
        1,
        2
      ],
      "2": [
        1,
        3
      ],
      "3": []
    }
  },
  {
    "doc": [
      1,
      2,
      [
        3,
        [
          4,
          5
        ]
      ]
    ],
    "expected": [
      1,
      2,
      [
        3,
        [
          4,
          5,
          {
            "foo": [
              "bar",
              "baz"
            ]
          }
        ]
      ]
    ],
    "name": "Adding to \"/-\" adds to the end of the array, even n levels down",
    "patch": {
      "2": {
        "1": {
          "2": [
            {
              "foo": [
                "bar",
                "baz"
              ]
            }
          ]
        }
      }
    }
  },
  {
    "doc": [
      1,
      2
    ],
    "expected": [
      1,
      2,
      {
        "foo": [
          "bar",
          "baz"
        ]
      }
    ],
    "name": "Adding to \"/-\" adds to the end of the array",
    "patch": {
      "2": [
        {
          "foo": [
            "bar",
            "baz"
          ]
        }
      ]
    }
  },
  {
    "doc": {
      "foo": "bar"
    },
    "expected": {
      "baz": "qux"
    },
    "name": "replacing the root of the document is possible with add",
    "patch": {
      "baz": [
        "qux"
      ],
      "foo": []
    }
  },
  {
    "doc": {
      "bar": 1,
      "baz": [
        {
          "qux": "hello"
        }
      ]
    },
    "expected": {
      "bar": 1,
      "baz": [
        {
          "qux": "hello"
        }
      ],
      "boo": {
        "qux": "hello"
      }
    },
    "name": "%{\"bar\" => 1, \"baz\" => [%{\"qux\" => \"hello\"}]} -> %{\"bar\" => 1, \"baz\" => [%{\"qux\" => \"hello\"}], \"boo\" => %{\"qux\" => \"hello\"}}",
    "patch": {
      "boo": [
        {
          "qux": "hello"
        }
      ]
    }
  },
  {
    "doc": {
      "bar": 1,
      "baz": [
        {
          "qux": "hello"
        }
      ]
    },
    "expected": {
      "bar": 1,
      "baz": [
        {},
        "hello"
      ]
    },
    "name": "%{\"bar\" => 1, \"baz\" => [%{\"qux\" => \"hello\"}]} -> %{\"bar\" => 1, \"baz\" => [%{}, \"hello\"]}",
    "patch": {
      "baz": {
        "0": {
          "qux": []
        },
        "1": [
          "hello"
        ]
      }
    }
  },
  {
    "doc": {
      "baz": [
        {
          "qux": "hello"
        }
      ],
      "foo": 1
    },
    "expected": {
      "bar": 1,
      "baz": [
        {
          "qux": "hello"
        }
      ]
    },
    "name": "%{\"baz\" => [%{\"qux\" => \"hello\"}], \"foo\" => 1} -> %{\"bar\" => 1, \"baz\" => [%{\"qux\" => \"hello\"}]}",
    "patch": {
      "bar": [
        1,
        "foo"
      ],
      "foo": []
    }
  },
  {
    "doc": {
      "foo": 1
    },
    "expected": {
      "foo": 1
    },
    "name": "Move to same location has no effect",
    "patch": {}
  },
  {
    "doc": {
      "foo": "bar"
    },
    "expected": {
      "foo": null
    },
    "name": "null value should still be valid obj property replace other value",
    "patch": {
      "foo": [
        null
      ]
    }
  },
  {
    "doc": {
      "foo": null
    },
    "expected": {},
    "name": "null value should be valid obj property to be removed",
    "patch": {
      "foo": []
    }
  },
  {
    "doc": {
      "foo": null
    },
    "expected": {
      "bar": null,
      "foo": null
    },
    "name": "null value should be valid obj property to be copied",
    "patch": {
      "bar": [
        1,
        "foo"
      ]
    }
  },
  {
    "doc": {
      "foo": null
    },
    "expected": {
      "bar": null
    },
    "name": "null value should be valid obj property to be moved",
    "patch": {
      "bar": [
        1,
        "foo"
      ],
      "foo": []
    }
  },
  {
    "doc": {
      "foo": null
    },
    "expected": {
      "foo": "truthy"
    },
    "name": "null value should be valid obj property to be replaced with something truthy",
    "patch": {
      "foo": [
        "truthy"
      ]
    }
  },
  {
    "doc": {
      "foo": 1
    },
    "expected": {
      "foo": 1
    },
    "name": "spurious patch properties",
    "patch": {}
  },
  {
    "doc": {
      "foo": "bar"
    },
    "expected": {
      "baz": "qux"
    },
    "name": "replace whole document",
    "patch": {
      "baz": [
        "qux"
      ],
      "foo": []
    }
  },
  {
    "doc": [
      "foo",
      "sil"
    ],
    "expected": [
      "foo",
      [
        "bar",
        "baz"
      ]
    ],
    "name": "value in array replace not flattened",
    "patch": {
      "1": [
        [
          "bar",
          "baz"
        ]
      ]
    }
  },
  {
    "doc": [
      ""
    ],
    "expected": [
      null
    ],
    "name": "[\"\"] -> [:null]",
    "patch": {
      "0": [
        null
      ]
    }
  },
  {
    "doc": [
      ""
    ],
    "expected": [
      false
    ],
    "name": "[\"\"] -> [false]",
    "patch": {
      "0": [
        false
      ]
    }
  },
  {
    "doc": [
      ""
    ],
    "expected": [
      true
    ],
    "name": "[\"\"] -> [true]",
    "patch": {
      "0": [
        true
      ]
    }
  },
  {
    "doc": [
      ""
    ],
    "expected": [
      0
    ],
    "name": "[\"\"] -> [0]",
    "patch": {
      "0": [
        0
      ]
    }
  },
  {
    "doc": [
      "foo"
    ],
    "expected": [
      "bar"
    ],
    "name": "[\"foo\"] -> [\"bar\"]",
    "patch": {
      "0": [
        "bar"
      ]
    }
  },
  {
    "doc": {
      "baz": [
        {
          "qux": "hello"
        }
      ],
      "foo": [
        1,
        2,
        3,
        4
      ]
    },
    "expected": {
      "baz": [
        {
          "qux": "world"
        }
      ],
      "foo": [
        1,
        2,
        3,
        4
      ]
    },
    "name": "%{\"baz\" => [%{\"qux\" => \"hello\"}], \"foo\" => [1, 2, 3, 4]} -> %{\"baz\" => [%{\"qux\" => \"world\"}], \"foo\" => [1, 2, 3, 4]}",
    "patch": {
      "baz": {
        "0": {
          "qux": [
            "world"
          ]
        }
      }
    }
  },
  {
    "doc": {
      "baz": [
        {
          "qux": "hello"
        }
      ],
      "foo": 1
    },
    "expected": {
      "baz": [
        {
          "qux": "hello"
        }
      ],
      "foo": [
        1,
        2,
        3,
        4
      ]
    },
    "name": "%{\"baz\" => [%{\"qux\" => \"hello\"}], \"foo\" => 1} -> %{\"baz\" => [%{\"qux\" => \"hello\"}], \"foo\" => [1, 2, 3, 4]}",
    "patch": {
      "foo": [
        [
          1,
          2,
          3,
          4
        ]
      ]
    }
  },
  {
    "doc": {
      "baz": [
        {
          "qux": "hello"
        }
      ],
      "foo": 1
    },
    "expected": {
      "baz": [
        {}
      ],
      "foo": 1
    },
    "name": "%{\"baz\" => [%{\"qux\" => \"hello\"}], \"foo\" => 1} -> %{\"baz\" => [%{}], \"foo\" => 1}",
    "patch": {
      "baz": {
        "0": {
          "qux": []
        }
      }
    }
  },
  {
    "doc": {
      "bar": [
        1,
        2,
        3,
        4
      ],
      "foo": 1
    },
    "expected": {
      "foo": 1
    },
    "name": "%{\"bar\" => [1, 2, 3, 4], \"foo\" => 1} -> %{\"foo\" => 1}",
    "patch": {
      "bar": []
    }
  },
  {
    "doc": [
      "foo",
      "sil"
    ],
    "expected": [
      "foo",
      [
        "bar",
        "baz"
      ],
      "sil"
    ],
    "name": "value in array add not flattened",
    "patch": {
      "1": [
        [
          "bar",
          "baz"
        ]
      ],
      "2": [
        1,
        1
      ]
    }
  },
  {
    "doc": {
      "1e0": "foo"
    },
    "expected": {
      "1e0": "foo"
    },
    "name": "test against implementation-specific numeric parsing",
    "patch": {}
  },
  {
    "doc": [
      "foo",
      "sil"
    ],
    "expected": [
      "foo",
      "sil",
      "bar"
    ],
    "name": "push item to array via last index + 1",
    "patch": {
      "2": [
        "bar"
      ]
    }
  },
  {
    "doc": [
      "foo",
      "sil"
    ],
    "expected": [
      "bar",
      "foo",
      "sil"
    ],
    "name": "[\"foo\", \"sil\"] -> [\"bar\", \"foo\", \"sil\"]",
    "patch": {
      "0": [
        "bar"
      ],
      "1": [
        1,
        0
      ],
      "2": [
        1,
        1
      ]
    }
  },
  {
    "doc": [
      "foo",
      "sil"
    ],
    "expected": [
      "foo",
      "bar",
      "sil"
    ],
    "name": "[\"foo\", \"sil\"] -> [\"foo\", \"bar\", \"sil\"]",
    "patch": {
      "1": [
        "bar"
      ],
      "2": [
        1,
        1
      ]
    }
  },
  {
    "doc": [
      "foo"
    ],
    "expected": [
      "foo",
      "bar"
    ],
    "name": "[\"foo\"] -> [\"foo\", \"bar\"]",
    "patch": {
      "1": [
        "bar"
      ]
    }
  },
  {
    "doc": {
      "foo": 1
    },
    "expected": {
      "0": "bar",
      "foo": 1
    },
    "name": "0 can be an array index or object element name",
    "patch": {
      "0": [
        "bar"
      ]
    }
  },
  {
    "doc": {
      "foo": 1
    },
    "expected": {
      "bar": null,
      "foo": 1
    },
    "name": "%{\"foo\" => 1} -> %{\"bar\" => :null, \"foo\" => 1}",
    "patch": {
      "bar": [
        null
      ]
    }
  },
  {
    "doc": {
      "foo": 1
    },
    "expected": {
      "bar": false,
      "foo": 1
    },
    "name": "%{\"foo\" => 1} -> %{\"bar\" => false, \"foo\" => 1}",
    "patch": {
      "bar": [
        false
      ]
    }
  },
  {
    "doc": {
      "foo": 1
    },
    "expected": {
      "bar": true,
      "foo": 1
    },
    "name": "%{\"foo\" => 1} -> %{\"bar\" => true, \"foo\" => 1}",
    "patch": {
      "bar": [
        true
      ]
    }
  },
  {
    "doc": {
      "baz": [
        {
          "qux": "hello"
        }
      ],
      "foo": 1
    },
    "expected": {
      "baz": [
        {
          "foo": "world",
          "qux": "hello"
        }
      ],
      "foo": 1
    },
    "name": "Add into composite value",
    "patch": {
      "baz": {
        "0": {
          "foo": [
            "world"
          ]
        }
      }
    }
  },
  {
    "doc": {
      "foo": 1
    },
    "expected": {
      "bar": [
        1,
        2
      ],
      "foo": 1
    },
    "name": "Add composite value at top level",
    "patch": {
      "bar": [
        [
          1,
          2
        ]
      ]
    }
  },
  {
    "doc": {
      "foo": {}
    },
    "expected": {
      "foo": {
        "": 1
      }
    },
    "name": "Add, /foo/ deep target (trailing slash)",
    "patch": {
      "foo": {
        "": [
          1
        ]
      }
    }
  },
  {
    "doc": {},
    "expected": {
      "": 1
    },
    "name": "Add, / target",
    "patch": {
      "": [
        1
      ]
    }
  },
  {
    "doc": "foo",
    "expected": "bar",
    "name": "Toplevel scalar values OK?",
    "patch": [
      "bar"
    ]
  },
  {
    "doc": {},
    "expected": {
      "foo": 1
    },
    "name": "toplevel object, integer",
    "patch": {
      "foo": [
        1
      ]
    }
  },
  {
    "doc": {},
    "expected": {
      "foo": "1"
    },
    "name": "toplevel object, numeric string",
    "patch": {
      "foo": [
        "1"
      ]
    }
  },
  {
    "doc": [
      "foo"
    ],
    "expected": [
      "foo"
    ],
    "name": "toplevel array, no change",
    "patch": {}
  },
  {
    "doc": [],
    "expected": [
      "foo"
    ],
    "name": "toplevel array",
    "patch": {
      "0": [
        "foo"
      ]
    }
  },
  {
    "doc": {
      "foo": null
    },
    "expected": {
      "foo": 1
    },
    "name": "add replaces any existing field",
    "patch": {
      "foo": [
        1
      ]
    }
  },
  {
    "doc": {
      "foo": {
        "bar": 2,
        "foo": 1
      }
    },
    "expected": {
      "foo": {
        "bar": 2,
        "foo": 1
      }
    },
    "name": "rearrangements OK?  How about one level down...",
    "patch": {}
  },
  {
    "doc": [
      {
        "bar": 2,
        "foo": 1
      }
    ],
    "expected": [
      {
        "bar": 2,
        "foo": 1
      }
    ],
    "name": "rearrangements OK?  How about one level down ... array",
    "patch": {}
  },
  {
    "doc": {
      "bar": 2,
      "foo": 1
    },
    "expected": {
      "bar": 2,
      "foo": 1
    },
    "name": "rearrangements OK?",
    "patch": {}
  },
  {
    "doc": {
      "foo": 1
    },
    "expected": {
      "foo": 1
    },
    "name": "empty patch list",
    "patch": {}
  },
  {
    "doc": {},
    "expected": {},
    "name": "empty list, empty docs",
    "patch": {}
  }
]